<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHO ·∫¢NH - VIDEO</title>
    <style>
        /* --- C·∫•u h√¨nh chung --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: white;
            font-family: sans-serif;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            position: relative;
            text-align: center;
            padding: 20px 0;
            border-bottom: 3px solid #000;
        }

        .rainbow-text {
            font-size: 2em;
            font-weight: bold;
            text-transform: uppercase;
            background-image: linear-gradient(to left, violet, indigo, blue, green, yellow, orange, red);
            -webkit-background-clip: text;
            color: transparent;
            animation: rainbow 2s linear infinite;
        }

        @keyframes rainbow { 100% { filter: hue-rotate(360deg); } }

        .flag-icon {
            position: absolute;
            top: 15px; right: 15px;
            width: 40px; height: 40px;
            background-color: red;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .star { color: yellow; font-size: 24px; margin-top: -2px; }

        /* --- Danh s√°ch th∆∞ m·ª•c --- */
        #folder-container {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }
        
        /* Responsive cho mobile: gi·∫£m xu·ªëng 3 c·ªôt n·∫øu m√†n h√¨nh nh·ªè */
        @media (max-width: 600px) {
            #folder-container { grid-template-columns: repeat(3, 1fr); }
        }

        .folder-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .folder-icon {
            font-size: 50px;
            color: #007bff;
            cursor: pointer;
        }

        .folder-name-group {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 5px;
            position: relative; /* ƒê·ªÉ ƒë·ªãnh v·ªã menu */
        }

        .folder-name {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }

        .folder-menu-btn {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
            color: #aaa;
            padding: 5px;
            font-size: 18px;
        }
        .folder-menu-btn:hover { color: white; }

        /* --- MENU ƒê·ªîI T√äN / X√ìA (M·ªöI) --- */
        .folder-popup-menu {
            display: none;
            position: absolute;
            top: 100%; 
            right: -10px;
            background-color: #333;
            border: 1px solid #555;
            border-radius: 5px;
            z-index: 50;
            width: 100px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .folder-popup-menu div {
            padding: 8px 10px;
            font-size: 13px;
            cursor: pointer;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        .folder-popup-menu div:last-child { border-bottom: none; }
        .folder-popup-menu div:hover { background-color: #444; }
        .menu-delete { color: #ff4d4d; }

        .add-folder-btn {
            font-size: 50px;
            color: #555;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        /* --- M·∫≠t kh·∫©u & Loading --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center; align-items: center;
            flex-direction: column; z-index: 1000;
        }
        .password-box input {
            padding: 10px; font-size: 16px; width: 250px;
            border-radius: 5px; border: 1px solid #555;
            background: #222; color: white;
        }
        .password-box button {
            padding: 10px 20px; margin-top: 10px;
            cursor: pointer; background: #007bff;
            color: white; border: none; border-radius: 5px;
        }
        .loader {
            border: 5px solid #f3f3f3; border-top: 5px solid #3498db;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- B√™n trong th∆∞ m·ª•c --- */
        #inside-folder-view { display: none; padding: 10px; }
        .folder-header-title {
            text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 10px;
        }
        .upload-bar {
            background: #333; padding: 10px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 8px; margin-bottom: 15px; position: relative;
        }
        .upload-plus { font-size: 30px; cursor: pointer; width: 100%; text-align: center; }
        .bulk-action-btn { position: absolute; right: 15px; font-size: 24px; cursor: pointer; }
        
        .bulk-menu {
            position: absolute; top: 45px; right: 10px;
            background: #444; border-radius: 5px; display: none; z-index: 10;
        }
        .bulk-menu div { padding: 10px 20px; border-bottom: 1px solid #555; cursor: pointer; }

        /* L∆∞·ªõi ·∫£nh */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 5px;
        }
        @media (min-width: 1400px) { .gallery-grid { grid-template-columns: repeat(15, 1fr); } }

        .gallery-item { position: relative; background: #222; border: 1px solid #333; }
        .gallery-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; }
        
        .gallery-actions {
            display: flex; justify-content: space-between;
            padding: 2px; background: #000;
        }
        .gallery-actions button {
            font-size: 10px; padding: 2px 5px; cursor: pointer; border: none; color: white;
        }
        .btn-del { background: #d9534f; }
        .btn-down { background: #5bc0de; }

        .selected-mark {
            position: absolute; top: 5px; right: 5px;
            width: 20px; height: 20px;
            background: rgba(0,255,0,0.5);
            border: 2px solid white; border-radius: 50%; display: none;
        }
        .gallery-item.selecting .selected-mark { display: block; }
        .gallery-item.selected .selected-mark { background: #00ff00; }

        /* Viewer */
        #image-viewer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        #image-viewer img { max-width: 90%; max-height: 80%; object-fit: contain; }
        .viewer-close {
            position: absolute; top: 20px; right: 20px;
            font-size: 40px; color: white; cursor: pointer;
        }
        .viewer-download {
            position: absolute; bottom: 30px; background: #007bff;
            color: white; padding: 10px 30px; border-radius: 20px;
            text-decoration: none; font-size: 16px;
        }
        #file-input { display: none; }
    </style>
</head>
<body>

    <div id="main-screen" onclick="closeAllFolderMenus()">
        <header>
            <div class="rainbow-text">KHO ·∫¢NH - VIDEO</div>
            <div class="flag-icon">
                <div class="star">‚òÖ</div>
            </div>
        </header>

        <div id="folder-container">
            <div class="folder-item add-folder-btn" onclick="createNewFolder()">
                +
            </div>
        </div>
    </div>

    <div id="password-overlay" class="overlay">
        <div class="password-box" id="pass-box-content">
            <h3 style="color:white">Nh·∫≠p M√£ B·∫£o M·∫≠t</h3>
            <input type="password" id="pass-input" placeholder="Nh·∫≠p m√£...">
            <br>
            <button onclick="checkPassword()">X√°c nh·∫≠n</button>
            <p id="pass-msg" style="margin-top:10px"></p>
        </div>
        <div class="loader" id="loader" style="display:none"></div>
    </div>

    <div id="inside-folder-view">
        <div class="folder-header-title">·∫¢nh Video</div>
        
        <div class="upload-bar">
            <div class="upload-plus" onclick="triggerUploadPrompt()">+</div>
            <div class="bulk-action-btn" onclick="toggleBulkMenu()">‚ò∞</div>
            
            <div class="bulk-menu" id="bulk-menu">
                <div onclick="enableSelectMode()">1. ƒê√°nh d·∫•u</div>
                <div onclick="deleteSelected()">2. X√≥a ƒë√£ ch·ªçn</div>
                <div onclick="backToMain()">Tho√°t th∆∞ m·ª•c</div>
            </div>
        </div>

        <div class="gallery-grid" id="gallery-grid"></div>
    </div>

    <input type="file" id="file-input" multiple accept="image/*,video/*" onchange="handleFileUpload(this)">

    <div id="image-viewer" onclick="closeViewer(event)">
        <div class="viewer-close" onclick="closeViewerNow()">√ó</div>
        <img id="viewer-img" src="" alt="Full Image">
        <a href="#" id="viewer-dl-btn" class="viewer-download" download>T·∫£i V·ªÅ</a>
    </div>

    <script>
        const SECRET_CODE = "12345678912345567890";
        let folders = JSON.parse(localStorage.getItem('myFolders')) || [];
        let currentFolderId = null;
        let isSelectMode = false;

        renderFolders();

        // --- QU·∫¢N L√ù TH∆Ø M·ª§C ---
        function createNewFolder() {
            const name = prompt("Nh·∫≠p t√™n th∆∞ m·ª•c m·ªõi:", "Th∆∞ m·ª•c m·ªõi");
            if (name) {
                folders.push({ id: Date.now(), name: name, files: [] });
                saveData(); renderFolders();
            }
        }

        function renderFolders() {
            const container = document.getElementById('folder-container');
            const addBtn = container.querySelector('.add-folder-btn');
            container.innerHTML = '';
            
            folders.forEach(folder => {
                const div = document.createElement('div');
                div.className = 'folder-item';
                div.innerHTML = `
                    <div class="folder-icon" onclick="openPasswordPrompt(${folder.id})">üìÅ</div>
                    <div class="folder-name-group">
                        <span class="folder-name">${folder.name}</span>
                        <span class="folder-menu-btn" onclick="toggleFolderMenu(event, ${folder.id})">‚ãÆ</span>
                        
                        <div id="menu-${folder.id}" class="folder-popup-menu">
                            <div onclick="renameFolder(${folder.id})">ƒê·ªïi t√™n</div>
                            <div class="menu-delete" onclick="deleteFolder(${folder.id})">X√≥a</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            container.appendChild(addBtn);
        }

        // --- X·ª¨ L√ù MENU ƒê·ªîI T√äN / X√ìA ---
        function toggleFolderMenu(event, id) {
            event.stopPropagation(); // NgƒÉn ch·∫∑n s·ª± ki·ªán click lan ra ngo√†i
            // ƒê√≥ng t·∫•t c·∫£ menu kh√°c
            closeAllFolderMenus();
            
            // M·ªü menu c·ªßa folder hi·ªán t·∫°i
            const menu = document.getElementById(`menu-${id}`);
            if (menu) {
                menu.style.display = 'block';
            }
        }

        function closeAllFolderMenus() {
            document.querySelectorAll('.folder-popup-menu').forEach(el => el.style.display = 'none');
        }

        function renameFolder(id) {
            const folder = folders.find(f => f.id === id);
            const newName = prompt("Nh·∫≠p t√™n m·ªõi:", folder.name);
            if (newName) {
                folder.name = newName;
                saveData();
                renderFolders();
            }
        }

        function deleteFolder(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th∆∞ m·ª•c n√†y?")) {
                folders = folders.filter(f => f.id !== id);
                saveData();
                renderFolders();
            }
        }

        // --- C√ÅC CH·ª®C NƒÇNG KH√ÅC (GI·ªÆ NGUY√äN) ---
        function openPasswordPrompt(id) {
            currentFolderId = id;
            document.getElementById('password-overlay').style.display = 'flex';
            document.getElementById('pass-box-content').style.display = 'block';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('pass-input').value = '';
            document.getElementById('pass-msg').innerText = '';
        }

        function checkPassword() {
            const input = document.getElementById('pass-input').value;
            if (input === SECRET_CODE) {
                document.getElementById('pass-msg').innerText = 'Ch√≠nh x√°c!';
                document.getElementById('pass-msg').style.color = 'lightgreen';
                document.getElementById('pass-box-content').style.display = 'none';
                document.getElementById('loader').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('password-overlay').style.display = 'none';
                    enterFolder();
                }, 3000);
            } else {
                document.getElementById('pass-msg').innerText = 'Sai m√£!';
                document.getElementById('pass-msg').style.color = 'red';
            }
        }

        function enterFolder() {
            document.getElementById('main-screen').style.display = 'none';
            document.getElementById('inside-folder-view').style.display = 'block';
            renderGallery();
        }

        function backToMain() {
            document.getElementById('inside-folder-view').style.display = 'none';
            document.getElementById('main-screen').style.display = 'block';
            document.getElementById('bulk-menu').style.display = 'none';
            isSelectMode = false;
        }

        function triggerUploadPrompt() {
            if (confirm("M·ªü Th∆∞ Vi·ªán ƒë·ªÉ t·∫£i ·∫£nh/video?")) {
                document.getElementById('file-input').click();
            }
        }

        function handleFileUpload(input) {
            if (input.files && input.files.length > 0) {
                const folderIndex = folders.findIndex(f => f.id === currentFolderId);
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        folders[folderIndex].files.push({
                            id: Date.now() + Math.random(),
                            src: e.target.result,
                            type: file.type.startsWith('video') ? 'video' : 'image',
                            selected: false
                        });
                        saveData();
                        renderGallery();
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        function toggleBulkMenu() {
            const menu = document.getElementById('bulk-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function renderGallery() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';
            const folder = folders.find(f => f.id === currentFolderId);
            if (!folder) return;

            folder.files.forEach(file => {
                const div = document.createElement('div');
                div.className = `gallery-item ${isSelectMode ? 'selecting' : ''} ${file.selected ? 'selected' : ''}`;
                
                let mediaHtml = file.type === 'video' 
                    ? `<video class="gallery-img" src="${file.src}" onclick="handleItemClick(${file.id})"></video>`
                    : `<img class="gallery-img" src="${file.src}" onclick="handleItemClick(${file.id})">`;

                div.innerHTML = `
                    <div class="selected-mark"></div>
                    ${mediaHtml}
                    <div class="gallery-actions">
                        <button class="btn-del" onclick="deleteSingleFile(${file.id})">X√≥a</button>
                        <a href="${file.src}" download="file" class="btn-down"><button class="btn-down">T·∫£i</button></a>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        function handleItemClick(fileId) {
            const folder = folders.find(f => f.id === currentFolderId);
            const file = folder.files.find(fi => fi.id === fileId);

            if (isSelectMode) {
                file.selected = !file.selected;
                saveData(); renderGallery();
            } else {
                openViewer(file.src);
            }
        }

        function openViewer(src) {
            document.getElementById('viewer-img').src = src;
            document.getElementById('viewer-dl-btn').href = src;
            document.getElementById('image-viewer').style.display = 'flex';
        }

        function closeViewer(e) {
            if (e.target.id === 'image-viewer') document.getElementById('image-viewer').style.display = 'none';
        }
        function closeViewerNow() { document.getElementById('image-viewer').style.display = 'none'; }

        function enableSelectMode() {
            isSelectMode = !isSelectMode;
            document.getElementById('bulk-menu').style.display = 'none';
            renderGallery();
        }

        function deleteSelected() {
            const idx = folders.findIndex(f => f.id === currentFolderId);
            folders[idx].files = folders[idx].files.filter(f => !f.selected);
            isSelectMode = false;
            saveData(); renderGallery();
        }

        function deleteSingleFile(fileId) {
            const idx = folders.findIndex(f => f.id === currentFolderId);
            folders[idx].files = folders[idx].files.filter(f => f.id !== fileId);
            saveData(); renderGallery();
        }

        function saveData() {
            try { localStorage.setItem('myFolders', JSON.stringify(folders)); } catch(e){ alert("B·ªô nh·ªõ ƒë·∫ßy!"); }
        }
    </script>
</body>
</html>
